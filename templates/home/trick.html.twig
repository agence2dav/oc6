{% extends 'base.html.twig' %}

{% block title %}{{ trick.title | raw}}{% endblock %}

{% block body %}

<div class="example-wrapper">

    <article class="card border-light mb-3">
    
        <div class="card-header">
            <h1>{{ trick.title | raw}}</h1>
            <div class="metadata">Rédigé par : {{ trick.username }}</div>
            <div class="metadata">Mis à jour le : {{ trick.updatedAt | date("d/m/Y") }}</div>
            {% if is_granted('ROLE_EDIT') or is_granted('ROLE_ADMIN') %}
                <div class="btn btn-primary"><a href="{{ path("edit_trick", {id: trick.id}) }}"><i class="bi bi-pencil"></i>Editer</a></div>
                {% if is_granted('ROLE_ADMIN') %}
                    {% if trick.status == 1 %}
                    <div class="btn btn-danger"><a href="{{ path("admin_tricksId", {id: trick.id}) }}"><i class="bi bi-eraser"></i>Dépublier</a></div>
                    {% else %}
                    <div class="btn btn-primary"><a href="{{ path("admin_tricksId", {id: trick.id}) }}"><i class="bi bi-eraser"></i>Publier</a></div>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
        <div class="card-boby">
        {% if trick.image !="no" %}
        <div class="image">
            <img src="{{ trick.image | raw}}" width="100%"/>
        </div>
        {% endif %}
        
        {% for media in trick.media %}
        <div class="image">
            <img src="{{ img_folder }}/{{ media.filename | raw}}" max-width="100%"/>
        </div>
        {% endfor %}

        <div class="content">
            <div class="text-body-primary">{{ trick.content | raw}}</div>
        </div>
    </article>

    <h3>Commentaires</h3>

    {% for message in app.flashes('thanks_comment') %}
    <div class="alert alert-success">
        <p>{{ message }}</p>
    <a class="btn btn-secondary" href="{{ path("show_trick", {"slug": trick.slug }) }}">De rien.</a>
    </div> 
    {% endfor %}

    {% if app.user %}
    <div class="form-floating mb-3 alert alert-primary">
        {{ form_start(formComment) }}
        {{ form_row(formComment.content, {"attr":{"placeholder":"Comentaire...", "class":"form-control"}}) }}
        <button type="submit" class="btn btn-success">Envoyer</button>
        {{ form_end(formComment) }}
    </div>

    {% else %}
        <div class="text-body-primary alert alert-primary">
        Vous devez être logué pour poster un commentaire.
    {#
    <a class="nav-link" href="{{ path("app_login2", {"slug": trick.slug }) }}">Connexion</a> 
    #}
        <a class="nav-link" href="/login?_target_path=/trick/{{ trick.slug }}">Connexion</a> 
        </div>
    {% endif %}

    {% for comment in trick.comments %}
    {% if comment.status == 1 %}

    <section class="card text-white bg-primary mb-3">
        <div class="card-header">
            <strong>{{ comment.username | raw}}</strong>
            <div class="metadata">{{ comment.date | date("d/m/Y H:i") }}</div>
        </div>
        <div class="card-boby">
            <div class="content">
                <div class="text-body-primary">{{ comment.content | raw}}</div>
            </div>
        </div>
    </section>
    {% endif %}
    {% endfor %}

</div>
{% endblock %}
